# Claude AI - 生產部署準備 Prompt

## 🎯 目標

將應用準備好部署到生產環境，確保安全性、穩定性和可維護性。

---

## 📋 部署準備任務

### 1. 環境配置

#### 1.1 環境變量管理
**目標**：安全地管理配置

**需要實現**：
- 完整的 `.env.example` 文件
- 生產環境變量文檔
- 環境變量驗證
- 敏感信息保護

**需要檢查**：
- `backend/.env.example` - 所有變量都有說明
- `frontend/.env.example` - 所有變量都有說明
- 確保沒有硬編碼的敏感信息

#### 1.2 配置驗證
**目標**：啟動前驗證配置

**需要實現**：
- 啟動時檢查必需環境變量
- 配置錯誤時顯示友好提示
- 配置文檔

**需要修改**：
- `backend/src/index.ts` - 添加配置檢查
- `frontend/src/main.tsx` - 添加配置檢查

---

### 2. 安全性加固

#### 2.1 安全頭設置
**目標**：防止常見攻擊

**需要實現**：
- Helmet.js 中間件（後端）
- Content Security Policy (CSP)
- XSS 防護
- CSRF 防護
- HTTPS 強制（生產環境）

**需要修改**：
- `backend/src/index.ts` - 添加 Helmet
- `frontend/index.html` - 添加 CSP meta 標籤

#### 2.2 輸入驗證強化
**目標**：防止惡意輸入

**需要檢查**：
- 所有 API 端點都有輸入驗證
- SQL 注入防護（Knex 參數化查詢）
- XSS 防護（清理用戶輸入）
- 文件上傳驗證

#### 2.3 認證安全
**目標**：保護用戶認證

**需要檢查**：
- JWT secret 強度
- Token 過期時間合理
- 密碼強度要求
- 登錄失敗限制

---

### 3. 錯誤處理和日誌

#### 3.1 錯誤處理
**目標**：優雅處理錯誤

**需要實現**：
- 統一的錯誤處理中間件
- 錯誤日誌記錄
- 生產環境錯誤訊息（不洩露敏感信息）
- 錯誤追蹤（Sentry 等）

**需要修改**：
- `backend/src/index.ts` - 錯誤處理中間件
- `frontend/src/lib/api.ts` - API 錯誤處理

#### 3.2 日誌系統
**目標**：記錄重要事件

**需要實現**：
- 結構化日誌（Winston 或 Pino）
- 日誌級別（error, warn, info, debug）
- 日誌輪轉（避免日誌文件過大）
- 敏感信息過濾

**需要修改**：
- `backend/src/index.ts` - 添加日誌中間件
- 創建 `backend/src/utils/logger.ts`

---

### 4. 數據庫準備

#### 4.1 遷移檢查
**目標**：確保數據庫結構正確

**需要檢查**：
- 所有遷移文件正確
- 遷移可以回滾
- 生產環境遷移腳本
- 數據庫備份策略

#### 4.2 數據庫優化
**目標**：提升數據庫性能

**需要檢查**：
- 所有必要的索引已創建
- 外鍵約束正確
- 數據庫連接池配置
- 查詢性能優化

---

### 5. 構建和打包

#### 5.1 前端構建優化
**目標**：優化生產構建

**需要實現**：
- 生產環境構建配置
- 代碼壓縮和混淆
- 資源優化
- Source maps（可選，用於調試）

**需要檢查**：
- `frontend/vite.config.ts` - 生產配置
- `frontend/package.json` - 構建腳本

#### 5.2 後端構建
**目標**：準備後端部署

**需要實現**：
- TypeScript 編譯配置
- 生產環境啟動腳本
- PM2 配置（進程管理）
- Docker 配置（可選）

---

### 6. 文檔準備

#### 6.1 部署文檔
**目標**：清晰的部署指南

**需要創建**：
- `DEPLOYMENT.md` - 部署指南
- 環境變量說明
- 數據庫設置指南
- 故障排查指南

#### 6.2 API 文檔
**目標**：API 使用說明

**需要創建**：
- Swagger/OpenAPI 文檔（可選）
- API 端點列表
- 請求/響應示例
- 錯誤碼說明

---

### 7. 監控和健康檢查

#### 7.1 健康檢查端點
**目標**：監控應用狀態

**需要實現**：
- `/health` 端點（基本健康檢查）
- `/health/db` 端點（數據庫連接檢查）
- 詳細狀態信息（可選）

**需要修改**：
- `backend/src/index.ts` - 添加健康檢查路由

#### 7.2 監控設置
**目標**：追蹤應用性能

**需要實現**：
- 錯誤追蹤（Sentry）
- 性能監控（可選）
- 日誌聚合（可選）
- 告警設置（可選）

---

### 8. 備份和恢復

#### 8.1 數據備份
**目標**：保護數據安全

**需要實現**：
- 數據庫備份腳本
- 自動備份計劃
- 備份恢復測試
- 備份存儲策略

#### 8.2 災難恢復
**目標**：快速恢復服務

**需要準備**：
- 恢復流程文檔
- 備份恢復測試
- 回滾計劃

---

## 🔧 部署檢查清單

### 安全性檢查
- [ ] 所有環境變量已設置
- [ ] 沒有硬編碼的敏感信息
- [ ] 安全頭已設置
- [ ] 輸入驗證完善
- [ ] 認證安全
- [ ] HTTPS 配置（生產環境）

### 配置檢查
- [ ] 環境變量文檔完整
- [ ] 配置驗證實現
- [ ] 生產環境配置正確

### 數據庫檢查
- [ ] 遷移文件正確
- [ ] 索引已創建
- [ ] 備份策略已制定

### 構建檢查
- [ ] 生產構建成功
- [ ] 資源優化完成
- [ ] 構建文件大小合理

### 文檔檢查
- [ ] 部署文檔完整
- [ ] API 文檔完整（如果適用）
- [ ] 故障排查文檔準備

### 監控檢查
- [ ] 健康檢查端點實現
- [ ] 錯誤追蹤設置（如果適用）
- [ ] 日誌系統配置

---

## 📝 部署步驟建議

### 1. 準備階段
1. 完成所有檢查清單項目
2. 在測試環境測試部署
3. 準備回滾計劃

### 2. 部署階段
1. 備份數據庫
2. 運行數據庫遷移
3. 部署後端
4. 部署前端
5. 驗證部署

### 3. 驗證階段
1. 測試所有功能
2. 檢查日誌
3. 監控性能
4. 確認無錯誤

---

## 🚀 開始準備

請按照檢查清單逐項完成。每個項目完成後，請提供：

1. **完成說明**：做了什麼準備
2. **修改的文件**：列出所有修改的文件
3. **新增的文件**：列出所有新增的文件
4. **配置說明**：如何配置和使用

**建議優先完成：環境配置、安全性加固、錯誤處理！**
