# Claude AI 審查優先級指南

## 🎯 推薦策略：Security + Bugs First

根據最佳實踐，建議按照以下順序進行審查和修復：

---

## 🔴 第一階段：安全性 + Bug 修復（最高優先級）

### 為什麼先做這個？

1. **安全漏洞會影響所有功能**：如果基礎不安全，新功能也會不安全
2. **Bug 會阻礙功能開發**：現有 bug 可能影響新功能的實現
3. **建立穩固基礎**：確保代碼庫穩定後再擴展功能

### 具體任務

#### 安全性檢查清單

- [ ] **JWT 實現**
  - 檢查 `backend/src/middleware/auth.ts`
  - 確認 secret 不會洩露
  - 驗證 token 過期和刷新機制
  - 檢查是否有 fallback secret（不安全）

- [ ] **API 安全**
  - 檢查 `backend/src/routes/*.ts` 所有路由
  - PATCH/PUT 請求是否有 mass assignment 防護
  - 輸入驗證是否充分（使用 Zod 或 express-validator）
  - 是否有速率限制（rate limiting）

- [ ] **數據驗證**
  - SQL 注入防護（確認 Knex 使用參數化查詢）
  - XSS 防護（清理用戶輸入）
  - CSRF 防護（添加 CSRF token）

- [ ] **認證和授權**
  - 密碼加密（bcrypt）是否正確
  - 權限檢查是否完善
  - 會話管理是否安全

#### Bug 修復清單

- [ ] **底部導覽列問題**
  - 文件：`frontend/src/components/BottomNav.tsx`
  - 問題：在某些情況下不顯示
  - 修復：確保 `position: fixed` 和 `z-index` 正確設置

- [ ] **表單驗證**
  - 前端：實時驗證和錯誤提示
  - 後端：輸入驗證和清理
  - 文件：所有表單頁面（`LoginPage.tsx`, `RegisterPage.tsx`, `CreateFoodBoxPage.tsx`）

- [ ] **錯誤處理**
  - API 錯誤處理：`frontend/src/lib/api.ts`
  - 用戶友好的錯誤訊息
  - 錯誤日誌記錄：`backend/src/index.ts`

- [ ] **類型錯誤**
  - 檢查所有 TypeScript 錯誤
  - 完善類型定義
  - 避免使用 `any` 類型

---

## 🟡 第二階段：高優先級功能（完成第一階段後）

### 為什麼現在做？

- 基礎已經穩固
- 安全性和 bug 已修復
- 可以安全地添加新功能

### 具體任務

- [ ] **地圖整合**
  - 使用 Leaflet 顯示飯盒位置
  - 發布時可以地圖選點
  - 瀏覽時顯示地圖視圖

- [ ] **圖片上傳**
  - 前端：圖片選擇和預覽
  - 後端：multer 處理上傳
  - 存儲：本地或雲存儲

- [ ] **搜索和篩選**
  - 按地區篩選
  - 按距離排序
  - 按時間篩選

- [ ] **通知系統**
  - 申請狀態變更通知
  - 新申請通知
  - 使用 React Query 輪詢或 WebSocket

---

## 🟢 第三階段：代碼質量和優化（最後）

### 具體任務

- [ ] **代碼重構**
  - 提取可重用組件
  - 減少重複代碼
  - 改進文件結構

- [ ] **性能優化**
  - React.memo、useMemo、useCallback
  - 圖片懶加載
  - 數據庫查詢優化

- [ ] **用戶體驗**
  - 加載狀態
  - 空狀態處理
  - 確認對話框
  - 觸控優化

---

## 📋 執行建議

### 給 Claude AI 的指令

```
請按照以下順序進行：

1. 首先進行安全性審查和修復
   - 檢查 JWT、API 安全、輸入驗證
   - 修復所有發現的安全漏洞

2. 然後修復現有 bug
   - 底部導覽列顯示問題
   - 表單驗證問題
   - 錯誤處理問題

3. 完成上述兩項後，再實現高優先級功能
   - 地圖整合
   - 圖片上傳
   - 搜索篩選
   - 通知系統

4. 最後進行代碼優化
   - 重構
   - 性能優化
   - UX 改進

請在每個階段完成後提供總結報告。
```

---

## ✅ 檢查點

在每個階段完成後，請確認：

- [ ] 所有安全性問題已修復
- [ ] 所有關鍵 bug 已修復
- [ ] 代碼可以正常運行
- [ ] 沒有引入新的問題

**只有在前一個階段完全完成後，才開始下一個階段！**
