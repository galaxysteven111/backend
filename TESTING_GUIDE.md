# 完整測試指南

## 🎯 測試目標

確保所有新功能都正常工作，特別是：
1. 地圖整合
2. 圖片上傳
3. 搜索篩選
4. 通知系統

---

## 📋 測試前準備

### 1. 運行數據庫遷移（必須）

```bash
cd backend
npx knex migrate:latest
```

這會創建 `notifications` 表。

### 2. 檢查依賴

```bash
# 後端
cd backend
npm install

# 前端
cd ../frontend
npm install leaflet react-leaflet @types/leaflet
npm install
```

### 3. 啟動服務

**終端 1 - 後端**：
```bash
cd backend
npm run dev
```

**終端 2 - 前端**：
```bash
cd frontend
npm run dev
```

### 4. 準備測試數據

建議創建至少 2-3 個測試帳號：
- 1 個捐贈者帳號
- 1-2 個接收者帳號

---

## 🧪 功能測試步驟

### 測試 1：地圖整合

#### 1.1 發布頁面 - 地圖選點
1. 登錄捐贈者帳號
2. 進入「發布飯盒」頁面
3. 滾動到地圖區域
4. **測試**：點擊地圖上的任意位置
5. **預期**：
   - 地圖上出現標記
   - 經緯度字段自動填充
   - 可以繼續點擊改變位置

#### 1.2 列表頁 - 地圖視圖
1. 進入「瀏覽飯盒」頁面
2. **測試**：點擊「地圖」按鈕切換到地圖視圖
3. **預期**：
   - 地圖顯示所有可用飯盒的標記
   - 點擊標記顯示飯盒信息
   - 點擊標記可以跳轉到詳情頁

#### 1.3 詳情頁 - 位置地圖
1. 點擊任意飯盒進入詳情頁
2. **測試**：滾動到「位置地圖」區域
3. **預期**：
   - 地圖顯示飯盒的具體位置
   - 標記清晰可見
   - 地圖可以縮放和拖動

#### 1.4 移動端測試
1. 使用手機瀏覽器或開發者工具模擬移動設備
2. **測試**：重複上述所有測試
3. **預期**：
   - 地圖在移動端正常顯示
   - 觸控操作正常
   - 地圖大小適配屏幕

---

### 測試 2：圖片上傳

#### 2.1 上傳單張圖片
1. 進入「發布飯盒」頁面
2. **測試**：點擊「選擇圖片」，選擇 1 張圖片
3. **預期**：
   - 圖片預覽顯示
   - 可以刪除圖片
   - 提交後圖片正確保存

#### 2.2 上傳多張圖片
1. **測試**：選擇 2-3 張圖片
2. **預期**：
   - 所有圖片都顯示預覽
   - 可以單獨刪除每張圖片
   - 提交後所有圖片都保存

#### 2.3 文件大小限制
1. **測試**：嘗試上傳 > 5MB 的圖片
2. **預期**：
   - 顯示錯誤提示
   - 圖片不被上傳

#### 2.4 文件類型限制
1. **測試**：嘗試上傳非圖片文件（如 .pdf, .txt）
2. **預期**：
   - 顯示錯誤提示
   - 文件不被上傳

#### 2.5 列表頁顯示
1. 進入「瀏覽飯盒」頁面
2. **預期**：
   - 有圖片的飯盒顯示縮略圖
   - 沒有圖片的飯盒顯示默認樣式

#### 2.6 詳情頁顯示
1. 進入有圖片的飯盒詳情頁
2. **預期**：
   - 圖片畫廊顯示所有圖片
   - 可以橫向滾動查看所有圖片
   - 圖片清晰可見

---

### 測試 3：搜索和篩選

#### 3.1 文本搜索
1. 進入「瀏覽飯盒」頁面
2. **測試**：在搜索欄輸入關鍵詞（如飯盒標題）
3. **預期**：
   - 實時顯示搜索結果
   - 結果包含關鍵詞
   - 搜索結果計數正確

#### 3.2 地區篩選
1. **測試**：點擊篩選按鈕，選擇一個地區
2. **預期**：
   - 只顯示該地區的飯盒
   - 結果計數更新
   - 篩選條件顯示

#### 3.3 組合篩選
1. **測試**：同時使用搜索和地區篩選
2. **預期**：
   - 結果同時符合兩個條件
   - 結果計數正確

#### 3.4 清除篩選
1. **測試**：點擊「清除篩選」按鈕
2. **預期**：
   - 所有篩選條件清除
   - 顯示所有飯盒
   - 搜索欄清空

#### 3.5 空結果處理
1. **測試**：使用不存在的關鍵詞搜索
2. **預期**：
   - 顯示友好的空狀態提示
   - 提供清除篩選選項

---

### 測試 4：通知系統

#### 4.1 創建申請通知
1. 使用接收者帳號登錄
2. 申請一個飯盒
3. **預期**：
   - 捐贈者帳號的通知鈴鐺顯示未讀數量（+1）
   - 通知列表中有新通知：「收到新的飯盒申請」

#### 4.2 批准申請通知
1. 使用捐贈者帳號登錄
2. 批准一個申請
3. **預期**：
   - 接收者帳號的通知鈴鐺顯示未讀數量（+1）
   - 通知列表中有新通知：「飯盒申請已被批准」

#### 4.3 拒絕申請通知
1. 使用捐贈者帳號登錄
2. 拒絕一個申請
3. **預期**：
   - 接收者帳號的通知鈴鐺顯示未讀數量（+1）
   - 通知列表中有新通知：「飯盒申請已被拒絕」

#### 4.4 通知鈴鐺
1. **測試**：查看頂部導航的通知鈴鐺
2. **預期**：
   - 有未讀通知時顯示紅色徽章
   - 徽章顯示未讀數量
   - 點擊鈴鐺跳轉到通知頁面

#### 4.5 通知列表
1. 進入通知頁面
2. **預期**：
   - 顯示所有通知（已讀和未讀）
   - 未讀通知有視覺區分
   - 可以點擊通知跳轉到相關飯盒

#### 4.6 標記已讀
1. **測試**：點擊一個未讀通知
2. **預期**：
   - 通知標記為已讀
   - 跳轉到相關飯盒
   - 未讀數量減少

#### 4.7 標記全部已讀
1. **測試**：點擊「標記全部為已讀」按鈕
2. **預期**：
   - 所有通知標記為已讀
   - 通知鈴鐺的徽章消失
   - 按鈕隱藏或禁用

#### 4.8 輪詢更新
1. **測試**：等待 30 秒（通知輪詢間隔）
2. **預期**：
   - 如果有新通知，通知鈴鐺自動更新
   - 不需要刷新頁面

---

## 🐛 常見問題排查

### 地圖不顯示
- **檢查**：Leaflet CSS 是否導入（`frontend/src/index.css`）
- **檢查**：依賴是否安裝（`leaflet`, `react-leaflet`）
- **檢查**：瀏覽器控制台是否有錯誤

### 圖片上傳失敗
- **檢查**：`backend/uploads/` 目錄是否存在
- **檢查**：後端靜態文件服務是否配置
- **檢查**：文件大小和類型限制

### 通知不顯示
- **檢查**：數據庫遷移是否運行（`npx knex migrate:latest`）
- **檢查**：後端 API 路由是否註冊
- **檢查**：前端通知組件是否正確集成

### 搜索不工作
- **檢查**：搜索是否在客戶端進行（應該實時過濾）
- **檢查**：瀏覽器控制台是否有錯誤

---

## ✅ 測試完成標準

所有測試通過後，應該：
- ✅ 地圖在所有頁面正常顯示和操作
- ✅ 圖片可以上傳和顯示
- ✅ 搜索和篩選正常工作
- ✅ 通知系統正常發送和顯示
- ✅ 移動端所有功能正常
- ✅ 沒有控制台錯誤
- ✅ 沒有明顯的性能問題

---

## 📝 測試報告模板

測試完成後，記錄：

```
測試日期：YYYY-MM-DD
測試人員：[姓名]

功能測試結果：
- 地圖整合：[通過/失敗] - [備註]
- 圖片上傳：[通過/失敗] - [備註]
- 搜索篩選：[通過/失敗] - [備註]
- 通知系統：[通過/失敗] - [備註]

發現的問題：
1. [問題描述]
2. [問題描述]

建議改進：
1. [建議]
2. [建議]
```

---

**開始測試吧！記得先運行數據庫遷移！** 🚀
