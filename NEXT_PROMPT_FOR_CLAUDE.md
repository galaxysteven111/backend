# 給 Claude AI 的下一步 Prompt

## 📌 直接複製這個 Prompt 發給 Claude AI

---

請幫助完成「香港捐飯盒平台」的最終部署準備工作。

## ✅ 已完成的工作

- ✅ 階段 1：安全性 + Bug 修復
- ✅ 階段 2：高優先級功能（地圖、圖片上傳、搜索篩選、通知系統）
- ✅ 階段 3：代碼優化和改進
- ✅ 性能優化專項
- ✅ 部署配置文件已創建（Railway、Render、Netlify）

## 🎯 當前任務：生產環境準備

請完成以下任務，確保應用可以順利部署到生產環境：

### 1. 環境變量驗證和文檔 ⚠️ 最高優先級

**任務 1.1**：創建環境變量驗證模塊
- **文件**：`backend/src/config/env.ts`
- **功能**：
  - 驗證所有必需的環境變量（JWT_SECRET, DATABASE_URL, FRONTEND_URL）
  - 啟動時檢查，缺少變量時優雅退出
  - 顯示清晰的錯誤訊息
- **在 `backend/src/index.ts` 中調用**：在應用啟動前調用驗證函數

**任務 1.2**：創建環境變量文檔
- **文件**：`ENV_VARIABLES.md`
- **內容**：
  - 所有環境變量列表（後端和前端）
  - 每個變量的說明和用途
  - 示例值（不包含真實密鑰）
  - 如何設置（不同平台）

### 2. 數據庫遷移腳本

**任務 2.1**：創建跨平台遷移腳本
- **文件**：`backend/scripts/migrate.js`
- **功能**：
  - 檢查 DATABASE_URL 環境變量
  - 運行 `npm run db:migrate`
  - 顯示遷移結果和錯誤處理
- **更新 `backend/package.json`**：添加 `migrate:prod` 腳本

**任務 2.2**：創建遷移文檔
- **文件**：`backend/MIGRATIONS.md`
- **內容**：如何運行遷移、遷移順序、回滾方法

### 3. 增強健康檢查

**任務 3.1**：改進 `/health` 端點
- **文件**：`backend/src/index.ts`
- **改進**：
  - 檢查數據庫連接狀態
  - 返回數據庫連接延遲
  - 返回版本信息和環境信息（不包含敏感信息）
- **響應格式**：
  ```json
  {
    "status": "ok",
    "timestamp": "...",
    "database": { "connected": true, "latency": "5ms" },
    "version": "1.0.0",
    "environment": "production"
  }
  ```

### 4. 安全性加固

**任務 4.1**：添加安全中間件
- **文件**：`backend/src/middleware/security.ts`
- **功能**：
  - 使用 Helmet.js 設置安全頭
  - XSS 防護、點擊劫持防護
  - HSTS（如果使用 HTTPS）
- **需要安裝**：`npm install helmet @types/helmet`
- **在 `backend/src/index.ts` 中使用**

**任務 4.2**：優化 CORS 配置
- **文件**：`backend/src/index.ts`
- **改進**：
  - 支持多個前端域名（通過環境變量配置）
  - 生產環境嚴格配置
  - 允許的域名列表：`FRONTEND_URL`（可包含多個，用逗號分隔）

### 5. 日誌配置（可選，但建議）

**任務 5.1**：創建日誌工具
- **文件**：`backend/src/utils/logger.ts`
- **功能**：
  - 結構化日誌（不同級別：error, warn, info, debug）
  - 生產環境不記錄敏感信息
  - 錯誤堆棧記錄
- **可選**：使用 `winston` 或簡單的 console.log 包裝

### 6. 錯誤處理改進

**任務 6.1**：統一錯誤格式
- **文件**：`backend/src/utils/errors.ts`
- **功能**：
  - 自定義錯誤類
  - 統一錯誤響應格式
  - 錯誤代碼映射
  - 生產環境錯誤訊息（不洩露敏感信息）

### 7. 部署檢查清單

**任務 7.1**：創建部署檢查清單
- **文件**：`DEPLOYMENT_CHECKLIST.md`
- **內容**：
  - 環境變量檢查
  - 數據庫連接檢查
  - 構建測試
  - API 測試
  - 功能測試步驟

## 🎯 優先級

### 🔴 必須完成（部署前）
1. 環境變量驗證和文檔
2. 數據庫遷移腳本
3. 健康檢查增強
4. 安全性加固

### 🟡 建議完成
5. 日誌配置
6. 錯誤處理改進
7. 部署檢查清單

## 📝 實現要求

- 使用 TypeScript 完整類型定義
- 錯誤處理完善
- 清晰的註釋和文檔
- 遵循現有代碼風格
- 不洩露敏感信息

## ✅ 完成標準

每個任務完成後：
- [ ] 功能正常工作
- [ ] 代碼符合規範
- [ ] 錯誤處理完善
- [ ] 文檔清晰
- [ ] 安全性檢查通過

## 🚀 開始實現

請按照優先級順序完成任務。每個任務完成後，請提供：
1. 實現說明
2. 修改的文件列表
3. 新增的文件列表
4. 使用說明
5. 測試建議

**請開始第一個任務：環境變量驗證和文檔！**

---

## 📚 參考

- 項目使用 Node.js + Express + TypeScript + PostgreSQL
- 後端端口：3001（或環境變量 PORT）
- 前端使用 Vite + React
- 已配置 Railway、Render、Netlify 部署文件
