# Claude AI 代碼審查與改進 Prompt

請作為一位資深的全棧開發專家，對這個「香港捐飯盒平台」進行全面的代碼審查、Bug 修復和功能增強。

## 專案背景

這是一個專為香港設計的飯盒捐贈平台，連接願意分享食物的捐贈者與需要幫助的人。目標是減少食物浪費，傳遞社區關愛。

## 技術棧

### 前端
- React 18 + TypeScript
- Vite（構建工具）
- Tailwind CSS（樣式）
- React Router（路由）
- React Query（數據獲取）
- Zustand（狀態管理）
- Axios（HTTP 請求）

### 後端
- Node.js + Express + TypeScript
- PostgreSQL（數據庫）
- Knex.js（數據庫遷移）
- JWT（身份驗證）
- Socket.io（即時通訊）

## 現有功能

### 已實現
1. ✅ 用戶註冊和登錄系統
2. ✅ 飯盒發布功能
3. ✅ 飯盒瀏覽和詳情頁
4. ✅ 申請飯盒功能
5. ✅ 申請管理（查看、批准、拒絕）
6. ✅ 個人資料頁面
7. ✅ 響應式設計（移動端優化）
8. ✅ 底部導覽列
9. ✅ 雙流程設計（捐贈/接收）

### 數據庫表結構
- `users` - 用戶表
- `food_boxes` - 飯盒表
- `applications` - 申請表
- `messages` - 消息表（未實現）
- `ratings` - 評價表（未實現）

## 需要審查和改進的方面

### 1. Bug 修復

#### 前端問題
- [ ] 底部導覽列在某些情況下可能不顯示
- [ ] 表單驗證不夠完善
- [ ] 錯誤處理不夠友好
- [ ] 圖片上傳功能未實現
- [ ] 地圖功能未整合
- [ ] 某些頁面缺少加載狀態
- [ ] 移動端觸控反饋可以更好

#### 後端問題
- [ ] API 錯誤處理可以更詳細
- [ ] 缺少輸入驗證和清理
- [ ] 沒有速率限制（rate limiting）
- [ ] 缺少日誌記錄
- [ ] 數據庫查詢可以優化
- [ ] 缺少單元測試

### 2. 功能增強

#### 高優先級功能
- [ ] **地圖整合**：使用 Leaflet/Mapbox 顯示飯盒位置
- [ ] **圖片上傳**：允許上傳飯盒照片
- [ ] **搜索和篩選**：按地區、時間、距離篩選飯盒
- [ ] **通知系統**：申請狀態變更時通知用戶
- [ ] **評價系統**：完成交易後可以評價對方
- [ ] **消息系統**：捐贈者和接收者可以即時溝通

#### 中優先級功能
- [ ] **個人資料編輯**：允許用戶更新個人信息
- [ ] **我的發布**：查看自己發布的所有飯盒
- [ ] **申請管理頁面**：捐贈者可以查看和管理所有申請
- [ ] **統計數據**：顯示用戶的捐贈/接收統計
- [ ] **收藏功能**：收藏感興趣的飯盒
- [ ] **分享功能**：分享飯盒到社交媒體

#### 低優先級功能
- [ ] **郵件通知**：重要事件發送郵件
- [ ] **管理員面板**：管理用戶和內容
- [ ] **數據導出**：導出統計數據
- [ ] **多語言支持**：支持英文界面
- [ ] **深色模式**：添加深色主題

### 3. 代碼質量改進

#### 前端
- [ ] 組件重用性：提取可重用組件
- [ ] 錯誤邊界：添加 React Error Boundary
- [ ] 性能優化：使用 React.memo、useMemo、useCallback
- [ ] 類型安全：完善 TypeScript 類型定義
- [ ] 代碼組織：更好的文件結構和模塊化
- [ ] 測試：添加單元測試和集成測試

#### 後端
- [ ] API 文檔：使用 Swagger/OpenAPI
- [ ] 中間件：添加請求日誌、錯誤處理中間件
- [ ] 驗證：使用 Zod 或 express-validator 進行輸入驗證
- [ ] 安全性：添加 CORS、CSRF 保護、SQL 注入防護
- [ ] 性能：數據庫索引優化、查詢優化
- [ ] 測試：添加 API 測試

### 4. 用戶體驗改進

- [ ] **加載狀態**：所有異步操作顯示加載動畫
- [ ] **錯誤提示**：更友好的錯誤訊息
- [ ] **空狀態**：當沒有數據時顯示友好的空狀態頁面
- [ ] **確認對話框**：重要操作前確認
- [ ] **表單驗證**：實時驗證和錯誤提示
- [ ] **自動保存**：表單草稿自動保存
- [ ] **離線支持**：PWA 功能，支持離線瀏覽

### 5. 安全性改進

- [ ] **輸入驗證**：所有用戶輸入都要驗證和清理
- [ ] **SQL 注入防護**：使用參數化查詢（Knex 已做，但需確認）
- [ ] **XSS 防護**：清理用戶輸入的 HTML
- [ ] **CSRF 保護**：添加 CSRF token
- [ ] **速率限制**：防止 API 濫用
- [ ] **密碼強度**：要求強密碼
- [ ] **會話管理**：JWT 過期和刷新機制

### 6. 性能優化

- [ ] **圖片優化**：壓縮和懶加載
- [ ] **代碼分割**：路由級別的代碼分割
- [ ] **緩存策略**：API 響應緩存
- [ ] **數據庫優化**：添加索引、優化查詢
- [ ] **CDN**：靜態資源使用 CDN
- [ ] **壓縮**：啟用 Gzip/Brotli 壓縮

## 代碼審查重點

### 1. 代碼結構
- 檢查文件組織是否合理
- 組件是否足夠模塊化
- 是否有重複代碼

### 2. 最佳實踐
- 是否遵循 React 最佳實踐
- 是否遵循 Node.js/Express 最佳實踐
- 是否遵循 TypeScript 最佳實踐

### 3. 安全性
- 是否有安全漏洞
- 認證和授權是否正確實現
- 數據驗證是否充分

### 4. 性能
- 是否有性能瓶頸
- 數據庫查詢是否優化
- 前端渲染是否高效

### 5. 可維護性
- 代碼是否易讀
- 註釋是否充分
- 錯誤處理是否完善

## 預期輸出

請提供：

1. **Bug 報告**
   - 列出發現的所有 bug
   - 每個 bug 的嚴重程度（P0/P1/P2）
   - 修復建議和代碼示例

2. **代碼改進建議**
   - 重構建議
   - 性能優化建議
   - 安全性改進建議

3. **功能實現**
   - 優先實現高優先級功能
   - 提供完整的代碼實現
   - 包含必要的測試

4. **文檔更新**
   - API 文檔
   - 代碼註釋
   - 使用說明

## 審查範圍

請重點關注以下文件：

### 前端核心文件
- `frontend/src/App.tsx`
- `frontend/src/components/Layout.tsx`
- `frontend/src/components/BottomNav.tsx`
- `frontend/src/pages/*.tsx`
- `frontend/src/lib/api.ts`
- `frontend/src/store/authStore.ts`

### 後端核心文件
- `backend/src/index.ts`
- `backend/src/routes/*.ts`
- `backend/src/middleware/auth.ts`
- `backend/src/config/database.ts`
- `backend/migrations/*.ts`

## 特別注意事項

1. **移動端優先**：確保所有功能在手機上都能正常使用
2. **用戶體驗**：關注易用性和直觀性
3. **性能**：確保頁面加載快速，操作流暢
4. **安全性**：保護用戶數據和隱私
5. **可擴展性**：代碼結構要便於未來擴展

## 審查優先級（重要！）

**請按照以下優先順序進行審查和修復：**

### 🔴 第一階段：安全性 + Bug 修復（最高優先級）

**必須先完成此階段，再進行功能開發！**

#### 安全性修復（P0）
1. **JWT Secret 處理**
   - 檢查是否有 fallback 機制
   - 確保 secret 不會洩露
   - 驗證 token 過期處理

2. **API 安全**
   - PATCH 請求的 mass assignment 防護
   - 輸入驗證和清理（防止 SQL 注入、XSS）
   - 速率限制（rate limiting）
   - CORS 配置檢查

3. **認證和授權**
   - 密碼加密驗證（bcrypt）
   - 會話管理
   - 權限檢查

#### Bug 修復（P0/P1）
1. **底部導覽列顯示問題**
   - 位置：`frontend/src/components/BottomNav.tsx`
   - 確保在所有情況下都正確顯示

2. **表單驗證**
   - 前端實時驗證
   - 後端輸入驗證
   - 錯誤訊息顯示

3. **錯誤處理**
   - API 錯誤處理
   - 用戶友好的錯誤提示
   - 錯誤日誌記錄

### 🟡 第二階段：高優先級功能

**完成第一階段後，再實現以下功能：**

1. 地圖整合（Leaflet）
2. 圖片上傳功能
3. 搜索和篩選功能
4. 通知系統

### 🟢 第三階段：代碼質量和優化

1. 代碼重構
2. 性能優化
3. 用戶體驗改進

---

## 開始審查

**請嚴格按照上述優先順序進行：**

1. ✅ **首先**：檢查並修復所有安全性問題
2. ✅ **然後**：修復現有 bug（特別是底部導覽列和表單驗證）
3. 🟡 **接著**：實現高優先級功能（見 `CLAUDE_AI_FEATURE_IMPLEMENTATION.md`）
4. 🟢 **最後**：優化代碼質量和用戶體驗

**請提供詳細的分析報告和具體的改進代碼。**

---

## 📌 重要提示

**如果階段 1（安全性 + Bug 修復）已完成，請查看 `CLAUDE_AI_FEATURE_IMPLEMENTATION.md` 進行階段 2（功能實現）。**
