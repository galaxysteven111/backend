# Claude AI - 部署準備和生產環境配置 Prompt

## ✅ 已完成的工作

- ✅ 階段 1：安全性 + Bug 修復
- ✅ 階段 2：高優先級功能（地圖、圖片上傳、搜索篩選、通知系統）
- ✅ 階段 3：代碼優化和改進
- ✅ 性能優化專項

---

## 🎯 當前任務：部署準備和生產環境配置

現在請幫助完成部署準備工作，確保應用可以順利部署到生產環境。

---

## 📋 任務清單

### 1. 環境變量管理 ⚠️ 重要

#### 1.1 創建環境變量文檔
**目標**：清晰記錄所有環境變量

**需要創建**：
- `backend/.env.production.example` - 後端生產環境變量示例
- `frontend/.env.production.example` - 前端生產環境變量示例（已存在，檢查並完善）
- `ENV_VARIABLES.md` - 環境變量完整文檔

**要求**：
- 列出所有必需的環境變量
- 說明每個變量的用途
- 提供示例值（不包含真實密鑰）
- 標註哪些是必需的，哪些是可選的

#### 1.2 環境變量驗證
**目標**：啟動前驗證必需變量

**需要實現**：
- `backend/src/config/env.ts` - 環境變量驗證模塊
- 啟動時檢查所有必需變量
- 缺少變量時顯示友好錯誤訊息

**必需變量檢查**：
- `JWT_SECRET` - 必須設置
- `DATABASE_URL` - 必須設置
- `FRONTEND_URL` - 必須設置（用於 CORS）

---

### 2. 數據庫遷移腳本

#### 2.1 創建遷移腳本
**目標**：簡化生產環境數據庫設置

**需要創建**：
- `backend/scripts/migrate.sh` - Linux/macOS 遷移腳本
- `backend/scripts/migrate.ps1` - Windows PowerShell 遷移腳本
- `backend/scripts/migrate.js` - Node.js 遷移腳本（跨平台）

**功能**：
- 檢查環境變量
- 運行所有遷移
- 顯示遷移狀態
- 錯誤處理

#### 2.2 遷移文檔
**目標**：清晰的遷移指南

**需要創建**：
- `backend/MIGRATIONS.md` - 遷移說明文檔

**內容**：
- 如何運行遷移
- 遷移順序
- 回滾方法
- 常見問題

---

### 3. 健康檢查和監控

#### 3.1 增強健康檢查端點
**目標**：提供詳細的健康狀態

**需要改進**：
- `backend/src/index.ts` - `/health` 端點

**功能**：
- 基本健康狀態
- 數據庫連接狀態
- 環境信息（不包含敏感信息）
- 版本信息

**響應示例**：
```json
{
  "status": "ok",
  "timestamp": "...",
  "database": {
    "connected": true,
    "latency": "5ms"
  },
  "version": "1.0.0",
  "environment": "production"
}
```

#### 3.2 日誌配置
**目標**：結構化日誌記錄

**需要實現**：
- `backend/src/utils/logger.ts` - 日誌工具

**功能**：
- 不同日誌級別（error, warn, info, debug）
- 結構化日誌格式
- 生產環境不記錄敏感信息
- 錯誤堆棧記錄

**可選**：使用 `winston` 或 `pino`

---

### 4. 安全性加固

#### 4.1 安全頭設置
**目標**：防止常見攻擊

**需要實現**：
- `backend/src/middleware/security.ts` - 安全中間件

**功能**：
- Helmet.js 配置
- Content Security Policy（CSP）
- XSS 防護
- 點擊劫持防護
- HSTS（如果使用 HTTPS）

#### 4.2 CORS 配置優化
**目標**：安全的跨域配置

**需要改進**：
- `backend/src/index.ts` - CORS 配置

**要求**：
- 支持多個前端域名（開發、生產）
- 環境變量配置允許的域名
- 憑證支持
- 預檢請求優化

---

### 5. 錯誤處理改進

#### 5.1 統一錯誤格式
**目標**：一致的錯誤響應

**需要實現**：
- `backend/src/utils/errors.ts` - 錯誤處理工具

**功能**：
- 自定義錯誤類
- 統一錯誤格式
- 錯誤代碼映射
- 生產環境錯誤訊息（不洩露敏感信息）

#### 5.2 錯誤日誌
**目標**：記錄所有錯誤

**需要實現**：
- 錯誤自動記錄
- 錯誤追蹤（可選：Sentry 集成）
- 錯誤通知（可選）

---

### 6. 部署配置檢查

#### 6.1 構建配置驗證
**目標**：確保構建配置正確

**需要檢查**：
- `backend/package.json` - 構建腳本
- `backend/tsconfig.json` - TypeScript 配置
- `frontend/vite.config.ts` - Vite 配置

**驗證**：
- 構建命令正確
- 輸出目錄正確
- 環境變量正確注入

#### 6.2 部署檢查清單
**目標**：部署前檢查

**需要創建**：
- `DEPLOYMENT_CHECKLIST.md` - 部署檢查清單

**內容**：
- 環境變量檢查
- 數據庫連接檢查
- 構建測試
- 功能測試

---

### 7. 文檔完善

#### 7.1 API 文檔
**目標**：清晰的 API 文檔

**需要創建**：
- `API_DOCUMENTATION.md` - API 端點文檔

**內容**：
- 所有 API 端點列表
- 請求/響應格式
- 認證要求
- 錯誤碼說明

#### 7.2 部署文檔
**目標**：完整的部署指南

**需要完善**：
- `DEPLOYMENT_GUIDE.md` - 完整部署指南

**內容**：
- 前置條件
- 步驟說明
- 環境變量設置
- 數據庫設置
- 故障排查

---

## 🎯 優先級

### 高優先級（必須完成）
1. ✅ 環境變量管理和驗證
2. ✅ 數據庫遷移腳本
3. ✅ 健康檢查增強
4. ✅ 安全性加固

### 中優先級（建議完成）
5. 日誌配置
6. 錯誤處理改進
7. 部署檢查清單

### 低優先級（可選）
8. API 文檔
9. 錯誤追蹤集成

---

## 📝 實現要求

### 代碼規範
- 使用 TypeScript 完整類型定義
- 遵循現有代碼風格
- 添加必要的註釋
- 錯誤處理完善

### 安全性
- 不洩露敏感信息
- 輸入驗證
- 安全頭設置
- CORS 配置正確

### 可維護性
- 清晰的文檔
- 易於理解的代碼
- 良好的錯誤訊息

---

## ✅ 完成標準

每個任務完成後，請確認：

- [ ] 功能正常工作
- [ ] 代碼符合規範
- [ ] 錯誤處理完善
- [ ] 文檔清晰完整
- [ ] 安全性檢查通過

---

## 🚀 開始實現

請按照優先級順序完成任務。每個任務完成後，請提供：

1. **實現說明**：做了什麼
2. **修改的文件**：列出所有修改的文件
3. **新增的文件**：列出所有新增的文件
4. **使用說明**：如何使用新功能
5. **測試建議**：如何測試

**請開始第一個任務：環境變量管理和驗證！**
