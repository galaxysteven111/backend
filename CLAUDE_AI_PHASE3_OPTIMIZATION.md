# Claude AI - 階段 3：代碼優化和改進 Prompt

## ✅ 階段 1 和 2 已完成

- ✅ 階段 1：安全性修復 + Bug 修復
- ✅ 階段 2：高優先級功能（地圖、圖片上傳、搜索篩選、通知系統）

---

## 🎯 階段 3：代碼優化和改進

現在請進行代碼優化、重構和改進，提升代碼質量、性能和用戶體驗。

---

## 📋 優化任務清單

### 1. 代碼重構和組件化

#### 1.1 提取可重用組件
**目標**：減少重複代碼，提高可維護性

**需要創建的組件**：
- `FormInput.tsx` - 統一的表單輸入組件
- `FormSelect.tsx` - 統一的選擇框組件
- `Card.tsx` - 統一的卡片組件
- `Button.tsx` - 統一的按鈕組件
- `LoadingSpinner.tsx` - 統一的加載動畫
- `EmptyState.tsx` - 統一的空狀態組件
- `ErrorBoundary.tsx` - 錯誤邊界組件

**要求**：
- 使用 TypeScript 完整類型定義
- 支持所有必要的 props（className, disabled, etc.）
- 符合現有設計系統
- 移動端適配

#### 1.2 重構現有組件
**目標**：改進組件結構和可讀性

**需要重構的文件**：
- `frontend/src/pages/CreateFoodBoxPage.tsx` - 提取表單邏輯
- `frontend/src/pages/FoodBoxListPage.tsx` - 提取篩選邏輯
- `frontend/src/pages/FoodBoxDetailPage.tsx` - 提取顯示邏輯

**要求**：
- 使用自定義 Hooks 提取邏輯
- 組件職責單一
- 提高可測試性

---

### 2. 性能優化

#### 2.1 React 性能優化
**目標**：減少不必要的重新渲染

**需要優化**：
- 使用 `React.memo` 包裝純組件
- 使用 `useMemo` 緩存計算結果
- 使用 `useCallback` 緩存函數
- 優化列表渲染（虛擬化，如果項目很多）

**重點文件**：
- `FoodBoxListPage.tsx` - 列表渲染優化
- `FoodBoxMap.tsx` - 地圖標記優化
- `NotificationBell.tsx` - 輪詢優化

#### 2.2 圖片優化
**目標**：提升圖片加載性能

**需要實現**：
- 圖片懶加載（Lazy loading）
- 圖片壓縮（上傳時）
- 響應式圖片（不同尺寸）
- 圖片佔位符（加載時顯示）

**工具**：
- 使用 `react-lazyload` 或原生 `loading="lazy"`
- 使用 `browser-image-compression` 壓縮

#### 2.3 數據獲取優化
**目標**：減少不必要的 API 請求

**需要優化**：
- 實現請求去重（deduplication）
- 優化 React Query 緩存策略
- 實現樂觀更新（optimistic updates）
- 預加載相關數據

---

### 3. 用戶體驗改進

#### 3.1 加載狀態改進
**目標**：提供更好的加載反饋

**需要改進**：
- 骨架屏（Skeleton screens）替代簡單的 spinner
- 漸進式加載（Progressive loading）
- 加載進度條

**重點頁面**：
- `FoodBoxListPage.tsx` - 列表加載
- `FoodBoxDetailPage.tsx` - 詳情加載
- `CreateFoodBoxPage.tsx` - 表單提交

#### 3.2 錯誤處理改進
**目標**：更友好的錯誤提示

**需要改進**：
- 統一的錯誤處理組件
- 更具體的錯誤訊息
- 錯誤恢復機制（重試按鈕）
- 離線狀態處理

#### 3.3 動畫和過渡
**目標**：提升交互體驗

**需要添加**：
- 頁面切換動畫
- 列表項出現動畫
- 按鈕點擊反饋
- 表單驗證動畫

**工具**：
- 使用 `framer-motion` 或 CSS transitions

---

### 4. 代碼質量改進

#### 4.1 TypeScript 類型完善
**目標**：提高類型安全性

**需要改進**：
- 定義完整的 API 響應類型
- 創建 `types/` 目錄組織類型定義
- 移除所有 `any` 類型
- 使用聯合類型（union types）和字面量類型

**需要創建的文件**：
- `frontend/src/types/api.ts` - API 類型定義
- `frontend/src/types/foodBox.ts` - 飯盒相關類型
- `frontend/src/types/user.ts` - 用戶相關類型
- `frontend/src/types/application.ts` - 申請相關類型

#### 4.2 代碼組織
**目標**：更好的文件結構

**需要改進**：
- 按功能模塊組織文件
- 統一的導入順序
- 添加文件頭註釋
- 提取常量到 `constants.ts`

#### 4.3 錯誤邊界
**目標**：優雅處理 React 錯誤

**需要實現**：
- 創建 `ErrorBoundary` 組件
- 在 `App.tsx` 中包裹路由
- 顯示友好的錯誤頁面
- 記錄錯誤到日誌

---

### 5. 功能增強

#### 5.1 搜索功能增強
**目標**：更強大的搜索能力

**需要添加**：
- 搜索歷史
- 搜索建議（自動完成）
- 高亮搜索結果
- 後端全文搜索（PostgreSQL）

#### 5.2 篩選功能增強
**目標**：更精細的篩選選項

**需要添加**：
- 時間範圍篩選（今天、本週、本月）
- 距離排序（如果用戶允許位置權限）
- 數量篩選
- 狀態篩選

#### 5.3 地圖功能增強
**目標**：更好的地圖體驗

**需要添加**：
- 標記聚合（marker clustering）- 如果標記很多
- 自定義標記圖標
- 路線顯示（可選）
- 地圖搜索

---

### 6. 可訪問性（Accessibility）

#### 6.1 ARIA 屬性
**目標**：提升可訪問性

**需要添加**：
- 所有交互元素添加 `aria-label`
- 表單添加 `aria-describedby`
- 錯誤訊息關聯到輸入框
- 鍵盤導航支持

#### 6.2 鍵盤支持
**目標**：完整的鍵盤操作

**需要實現**：
- 所有功能都可以用鍵盤操作
- Tab 順序合理
- 快捷鍵支持（可選）

#### 6.3 對比度和字體
**目標**：符合 WCAG 標準

**需要檢查**：
- 文字對比度 ≥ 4.5:1
- 字體大小 ≥ 16px
- 觸控目標 ≥ 44px

---

### 7. 測試準備

#### 7.1 測試工具設置
**目標**：為測試做準備

**需要設置**：
- Jest 配置
- React Testing Library 設置
- 測試工具函數

#### 7.2 關鍵組件測試
**目標**：確保核心功能穩定

**需要測試**：
- 表單驗證邏輯
- API 調用邏輯
- 狀態管理邏輯

---

## 🎯 優先級建議

### 高優先級（先做）
1. ✅ 提取可重用組件（FormInput, Button, Card 等）
2. ✅ React 性能優化（memo, useMemo, useCallback）
3. ✅ 圖片懶加載
4. ✅ TypeScript 類型完善
5. ✅ 錯誤邊界實現

### 中優先級（然後做）
1. 骨架屏加載狀態
2. 搜索功能增強
3. 篩選功能增強
4. 動畫和過渡效果
5. 可訪問性改進

### 低優先級（最後做）
1. 測試設置
2. 地圖標記聚合
3. 路線顯示

---

## 📝 實現要求

### 代碼規範
- 使用 TypeScript 嚴格模式
- 遵循現有的代碼風格
- 添加必要的註釋
- 保持組件小而專注

### 性能標準
- 首屏加載時間 < 2 秒
- 交互響應時間 < 100ms
- 圖片加載優化
- 減少不必要的重新渲染

### 用戶體驗標準
- 所有操作有視覺反饋
- 錯誤訊息清晰友好
- 加載狀態明確
- 移動端體驗流暢

---

## ✅ 完成標準

每個優化完成後，請確認：

- [ ] 功能正常工作
- [ ] 性能有明顯提升
- [ ] 代碼質量提高
- [ ] 沒有引入新的 bug
- [ ] 移動端適配良好
- [ ] 可訪問性提升

---

## 🚀 開始優化

請按照優先級順序進行優化。每個優化完成後，請提供：

1. **優化說明**：做了什麼優化
2. **修改的文件**：列出所有修改的文件
3. **新增的文件**：列出所有新增的文件
4. **性能指標**：優化前後的對比（如果適用）
5. **使用說明**：如何使用新組件/功能

**請開始第一個優化：提取可重用組件！**
