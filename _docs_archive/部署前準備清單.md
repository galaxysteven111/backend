# 📋 部署前準備清單

## ✅ 部署前必須完成的準備工作

---

## 1. 📦 代碼準備

### 1.1 Git 倉庫準備
- [ ] 代碼已提交到 Git
- [ ] 所有文件已添加到 Git（除了 `.gitignore` 中的文件）
- [ ] 已推送到 GitHub/GitLab/Bitbucket
- [ ] 確認 `.gitignore` 正確配置（避免提交敏感文件）

**檢查命令**：
```bash
git status
git log --oneline -5  # 查看最近提交
```

### 1.2 敏感文件檢查
- [ ] `.env` 文件沒有被提交（應該在 `.gitignore` 中）
- [ ] `node_modules/` 沒有被提交
- [ ] `dist/` 沒有被提交
- [ ] `uploads/` 目錄沒有被提交（只有 `.gitkeep` 可以提交）

---

## 2. 🔐 環境變量準備

### 2.1 後端環境變量

**必需變量**：
- [ ] `JWT_SECRET` - JWT 密鑰（必須生成）
- [ ] `DATABASE_URL` - 數據庫連接字符串（Railway 會自動設置）
- [ ] `FRONTEND_URL` - 前端 URL（用於 CORS）
- [ ] `NODE_ENV` - 設置為 `production`

**生成 JWT_SECRET**：
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**記錄這些值**（不要提交到 Git）：
```
JWT_SECRET=生成的密鑰
FRONTEND_URL=https://your-netlify-site.netlify.app（部署前端後更新）
NODE_ENV=production
```

### 2.2 前端環境變量

**必需變量**：
- [ ] `VITE_API_URL` - 後端 API URL（部署後端後獲取）

**記錄這個值**：
```
VITE_API_URL=https://your-backend.up.railway.app/api
```

---

## 3. 🗄️ 數據庫準備

### 3.1 遷移文件檢查
- [ ] 所有遷移文件已創建（001-007）
- [ ] 遷移文件沒有錯誤
- [ ] 遷移順序正確

**檢查遷移文件**：
```bash
cd backend
ls migrations/
```

應該看到：
- 001_create_users.ts
- 002_create_food_boxes.ts
- 003_create_applications.ts
- 004_create_messages.ts
- 005_create_ratings.ts
- 006_create_notifications.ts
- 007_add_performance_indexes.ts

### 3.2 遷移腳本檢查
- [ ] `backend/scripts/migrate.js` 存在
- [ ] `backend/package.json` 中有 `migrate:prod` 腳本

---

## 4. 🔧 配置文件檢查

### 4.1 後端配置
- [ ] `backend/package.json` - 構建和啟動腳本正確
- [ ] `backend/tsconfig.json` - TypeScript 配置正確
- [ ] `backend/knexfile.ts` - 數據庫配置正確
- [ ] `backend/Procfile` - 部署配置存在
- [ ] `backend/railway.json` - Railway 配置存在（如果使用 Railway）

### 4.2 前端配置
- [ ] `frontend/package.json` - 構建腳本正確
- [ ] `frontend/vite.config.ts` - Vite 配置正確
- [ ] `netlify.toml` - Netlify 配置存在

---

## 5. 🛡️ 安全性檢查

### 5.1 代碼安全
- [ ] 沒有硬編碼的密鑰或敏感信息
- [ ] 所有環境變量都通過環境變量設置
- [ ] 輸入驗證已實現
- [ ] SQL 注入防護（使用參數化查詢）

### 5.2 配置文件安全
- [ ] `.env` 文件在 `.gitignore` 中
- [ ] `.env.example` 不包含真實密鑰
- [ ] 敏感文件沒有被提交

---

## 6. 📝 文檔準備

### 6.1 部署文檔
- [ ] `DEPLOYMENT_CHECKLIST.md` - 部署檢查清單
- [ ] `ENV_VARIABLES.md` - 環境變量文檔
- [ ] `backend/MIGRATIONS.md` - 遷移指南
- [ ] `QUICK_DEPLOY_BACKEND.md` - 後端快速部署指南
- [ ] `QUICK_DEPLOY_NETLIFY.md` - 前端快速部署指南

### 6.2 記錄重要信息
準備一個文檔記錄：
- [ ] GitHub 倉庫 URL
- [ ] 後端部署平台（Railway/Render/Fly.io）
- [ ] 前端部署平台（Netlify）
- [ ] 生成的 JWT_SECRET（安全保存）
- [ ] 後端 API URL（部署後記錄）
- [ ] 前端 URL（部署後記錄）

---

## 7. 🧪 本地測試

### 7.1 後端測試
- [ ] 後端可以正常啟動
- [ ] 數據庫連接正常
- [ ] API 端點可以訪問
- [ ] 健康檢查端點正常：`/health`

**測試命令**：
```bash
cd backend
npm install
npm run build
npm start
# 訪問 http://localhost:3001/health
```

### 7.2 前端測試
- [ ] 前端可以正常構建
- [ ] 構建沒有錯誤
- [ ] 構建產物在 `frontend/dist` 目錄

**測試命令**：
```bash
cd frontend
npm install
npm run build
# 檢查 frontend/dist 目錄
```

---

## 8. 🌐 平台帳號準備

### 8.1 後端平台
- [ ] Railway 帳號已創建（https://railway.app）
- [ ] 或 Render 帳號已創建（https://render.com）
- [ ] 或 Fly.io 帳號已創建（https://fly.io）

### 8.2 前端平台
- [ ] Netlify 帳號已創建（https://app.netlify.com）

### 8.3 Git 平台
- [ ] GitHub/GitLab/Bitbucket 帳號已創建
- [ ] 倉庫已創建並連接

---

## 9. 📊 部署順序規劃

### 推薦順序：
1. **先部署後端**
   - 獲取後端 API URL
   - 運行數據庫遷移
   - 測試健康檢查

2. **再部署前端**
   - 設置 `VITE_API_URL` 環境變量
   - 更新後端 `FRONTEND_URL`（CORS）

3. **最後測試**
   - 端到端測試
   - 功能測試
   - 性能測試

---

## 10. ✅ 最終檢查

### 部署前最後確認：
- [ ] 所有代碼已提交並推送
- [ ] 環境變量已準備好
- [ ] JWT_SECRET 已生成
- [ ] 本地測試通過
- [ ] 文檔已閱讀
- [ ] 平台帳號已準備好

---

## 📝 準備工作記錄表

**填寫這個表格**：

```
項目名稱：捐飯盒平台
GitHub 倉庫：https://github.com/your-username/foodbox-platform
後端平台：Railway / Render / Fly.io
前端平台：Netlify

後端環境變量：
- JWT_SECRET: [生成後填寫]
- FRONTEND_URL: [部署前端後填寫]
- NODE_ENV: production

前端環境變量：
- VITE_API_URL: [部署後端後填寫]

部署後 URL：
- 後端 API: [部署後填寫]
- 前端網站: [部署後填寫]
```

---

## 🚀 準備完成後

當所有項目都打勾 ✅ 後，你可以：

1. **開始部署後端**
   - 查看 `QUICK_DEPLOY_BACKEND.md`

2. **開始部署前端**
   - 查看 `QUICK_DEPLOY_NETLIFY.md`

3. **參考完整指南**
   - 查看 `FINAL_DEPLOYMENT_GUIDE.md`

---

## 🆘 遇到問題？

如果準備過程中遇到問題：

1. **檢查文檔**
   - `ENV_VARIABLES.md` - 環境變量說明
   - `backend/MIGRATIONS.md` - 數據庫遷移說明

2. **檢查配置**
   - 確認所有配置文件存在
   - 確認腳本正確

3. **本地測試**
   - 確保本地可以正常運行
   - 確保構建沒有錯誤

---

**準備好了嗎？開始部署吧！** 🎉
